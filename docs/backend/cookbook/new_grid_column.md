# How to add new grid to your module

For more details about **Grid** click --> [Here](backend/api/objects/grid.md)

## Creating Action

First you need to create ACTION which would be responsible for displaying custom grid. --> [How to create new endpoint (action)](backend/cookbook/new_endpoint.md)

Naming convention is `moduleNameGridReadAction.php`. 

```php
use Ergonode\Core\Domain\ValueObject\Language;
use Ergonode\Grid\RequestGridConfiguration;

    public function __invoke(Language $language, RequestGridConfiguration $configuration): Response
    {
        $dataSet = $this->query->getDataSet($language);

        $data = $this->renderer->render(
            $this->grid,
            $configuration,
            $dataSet,
            $language
        );

        return new SuccessResponse($data);
    }

```

`__invoke` method needs to take at least two variables `Language` and `RequestGridConfiguration`.  

To get all data which you want to display in your grid you need to create in query `getDataSet` method. 

## getDataSet

You need to add method to your query class living in `Ergonode\Your-module\Persistence\Dbal\Query\` namespace which would be retrieving data from Database.


**Example**

```php
use Ergonode\Grid\DbalDataSet;

  /**
     * @param Language $language
     *
     * @return DataSetInterface
     */
    public function getDataSet(Language $language): DataSetInterface
    {
        $query = $this->connection->createQueryBuilder();
        $query
            ->select('*')
            ->from(sprintf('(%s)', $this->getQuery($language)->getSQL()), 't');

        return new DbalDataSet($query);
    }

```

This method needs to return `DbalDataSet` object.


## Grid object

To render a grid you would need a Grid object which is responsible for defining structure of your grid.

This object lives in `Your-module\Infrastructure\Grid\` namespace and extends `Ergonode\Grid\AbstractGrid`

Name convention is `YourModuleGrid.php`.

**Example**

```php
      /**
       * @param GridConfigurationInterface $configuration
       * @param Language                   $language
       */
      public function init(GridConfigurationInterface $configuration, Language $language): void
      {
          $collection = $this->query->getDictionary();
  
          $this->addColumn('id', new TextColumn('id', 'Id'));
          $this->addColumn('name', new TextColumn('name', 'Name', new TextFilter()));
          $this->addColumn('default_text', new TextColumn('default_text', 'Default text', new TextFilter()));
          $this->addColumn('default_image', new TextColumn('default_image', 'Default Image', new TextFilter()));
          $this->addColumn('image_id', new TextColumn('image_id', 'Icon', new TextFilter()));
          $this->addColumn('group_id', new TextColumn('group_id', 'Group', new SelectFilter($collection)));
          $this->addColumn('_links', new LinkColumn('hal', [
              'get' => [
                  'route' => 'ergonode_condition_conditionset_read',
                  'parameters' => ['language' => $language->getCode(), 'conditionSet' => '{id}'],
              ],
              'edit' => [
                  'route' => 'ergonode_condition_conditionset_change',
                  'parameters' => ['language' => $language->getCode(), 'conditionSet' => '{id}'],
                  'method' => Request::METHOD_PUT,
              ],
              'delete' => [
                  'route' => 'ergonode_condition_conditionset_delete',
                  'parameters' => ['language' => $language->getCode(), 'conditionSet' => '{id}'],
                  'method' => Request::METHOD_DELETE,
              ],
          ]));
      }
```

Whole logic of this class is in `init` method. It tells the system what type and name of columns we would have in our grid. 

Using `addColumn` method:
 * first argument - `column id` which should be the same as column you retrieved from database,
 * second argument - [Column Object](#column-object)

## Column Object

You can choose grid columns types which are predefined under `Ergonode\Grid\Column\` namespace or created custom one.

[How to create a new column type?](backend/cookbook/new_grid_column_type.md)

In constructor:
 * first argument - `field` we should be the same as column id from `addColumn` method
 * second argument - `label` and is name under which this column would be visible in grid.
 * third argument - `DataFilter` object which is responsible for type of data filtering on given column 
 (predefined Filter types are stored under `Ergonode\Grid\Filter` namespace)

## Links


Across all grids in Ergonode application generating links for getting, editing and deleting object in each raw.

Not always all links are available, it depends on user privileges. 

`route` - you define link to what endpoint should be generated by putting endpoint name
`parameters` - if this endpoint needs some parameters which needs to be passed to link (GET method) you need to put it here
`method` - what is request method of given endpoint

** Part of grid response ** 

```json
    {
       "id": "e63a6ca3-d0c6-49b5-b5fd-bedf29f79ac1",
       "name": "Template",
       "default_text": null,
       "default_image": null,
       "image_id": null,
       "group_id": "418c48d3-d2c3-4c30-b627-93850c38d59c",
       "_links": {
         "get": {
           "href": "http://127.0.0.1:8000/api/v1/EN/conditionsets/e63a6ca3-d0c6-49b5-b5fd-bedf29f79ac1",
           "method": "GET"
         },
         "edit": {
           "href": "http://127.0.0.1:8000/api/v1/EN/conditionsets/e63a6ca3-d0c6-49b5-b5fd-bedf29f79ac1",
           "method": "PUT"
         },
         "delete": {
           "href": "http://127.0.0.1:8000/api/v1/EN/conditionsets/e63a6ca3-d0c6-49b5-b5fd-bedf29f79ac1",
           "method": "DELETE"
         }
       }
     }
   ],
```
